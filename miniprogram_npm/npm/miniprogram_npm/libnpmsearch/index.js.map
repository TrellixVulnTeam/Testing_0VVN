{"version":3,"sources":["index.js"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.js","sourcesContent":["\n\nconst npmFetch = require('npm-registry-fetch')\n\nmodule.exports = search\nfunction search (query, opts) {\n  return search.stream(query, opts).collect()\n}\nsearch.stream = searchStream\nfunction searchStream (query, opts = {}) {\n  opts = {\n    detailed: false,\n    limit: 20,\n    from: 0,\n    quality: 0.65,\n    popularity: 0.98,\n    maintenance: 0.5,\n    ...opts.opts, // this is to support the cli's --searchopts parameter\n    ...opts,\n  }\n\n  switch (opts.sortBy) {\n    case 'optimal': {\n      opts.quality = 0.65\n      opts.popularity = 0.98\n      opts.maintenance = 0.5\n      break\n    }\n    case 'quality': {\n      opts.quality = 1\n      opts.popularity = 0\n      opts.maintenance = 0\n      break\n    }\n    case 'popularity': {\n      opts.quality = 0\n      opts.popularity = 1\n      opts.maintenance = 0\n      break\n    }\n    case 'maintenance': {\n      opts.quality = 0\n      opts.popularity = 0\n      opts.maintenance = 1\n      break\n    }\n  }\n  return npmFetch.json.stream('/-/v1/search', 'objects.*',\n    {\n      ...opts,\n      query: {\n        text: Array.isArray(query) ? query.join(' ') : query,\n        size: opts.limit,\n        from: opts.from,\n        quality: opts.quality,\n        popularity: opts.popularity,\n        maintenance: opts.maintenance,\n      },\n      mapJSON: (obj) => {\n        if (obj.package.date) {\n          obj.package.date = new Date(obj.package.date)\n        }\n        if (opts.detailed) {\n          return obj\n        } else {\n          return obj.package\n        }\n      },\n    }\n  )\n}\n"]}