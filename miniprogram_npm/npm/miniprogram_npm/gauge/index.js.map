{"version":3,"sources":["index.js","plumbing.js","render-template.js","wide-truncate.js","error.js","template-item.js","has-color.js","themes.js","theme-set.js","base-theme.js","spin.js","progress-bar.js","set-interval.js","process.js","set-immediate.js"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;AACA,ACHA;ADIA,ACHA;ADIA,ACHA;ADIA,ACHA,ACHA;AFOA,ACHA,ACHA;AFOA,ACHA,ACHA;AFOA,ACHA,ACHA,ACHA;AHUA,ACHA,ACHA,ACHA;AHUA,ACHA,ACHA,ACHA;ACFA,AJYA,ACHA,ACHA,ACHA;ACFA,AJYA,ACHA,ACHA,ACHA;ACFA,AJYA,ACHA,ACHA,ACHA;ACFA,AJYA,ACHA,ACHA,AGTA,AFMA;ACFA,AJYA,ACHA,ACHA,AGTA,AFMA;ACFA,AJYA,ACHA,ACHA,AGTA,AFMA;ACFA,AENA,ANkBA,ACHA,ACHA,AGTA,AFMA;ACFA,AENA,ANkBA,ACHA,ACHA,AGTA,AFMA;ACFA,AENA,ANkBA,ACHA,ACHA,AGTA,AFMA;ACFA,AENA,ANkBA,ACHA,ACHA,AGTA,AENA,AJYA;ACFA,AENA,ANkBA,ACHA,ACHA,AGTA,AENA,AJYA;ACFA,AJYA,ACHA,ACHA,AGTA,AENA,AJYA;ACFA,AJYA,ACHA,ACHA,AGTA,AGTA,ADGA,AJYA;ACFA,AJYA,ACHA,ACHA,AGTA,AGTA,ADGA,AJYA;ACFA,AJYA,ACHA,ACHA,AGTA,AGTA,ADGA,AJYA;AMjBA,ALeA,AJYA,ACHA,ACHA,AGTA,AGTA,ADGA,AJYA;AMjBA,ALeA,AJYA,ACHA,ACHA,AGTA,AGTA,ADGA,AJYA;AMjBA,ALeA,AJYA,ACHA,ACHA,AGTA,AGTA,ADGA,AJYA;AMjBA,ALeA,AJYA,ACHA,ACHA,AQxBA,ALeA,AGTA,ADGA,AJYA;AMjBA,ALeA,AJYA,ACHA,ACHA,AQxBA,ALeA,AGTA,ADGA,AJYA;AMjBA,ALeA,AJYA,ACHA,ACHA,AQxBA,ALeA,AGTA,ADGA,AJYA;AMjBA,ALeA,AJYA,ACHA,AU9BA,AT2BA,AQxBA,ALeA,AGTA,ADGA,AJYA;AMjBA,ALeA,AJYA,ACHA,AU9BA,AT2BA,AQxBA,ALeA,AGTA,ADGA,AJYA;AMjBA,ALeA,AJYA,ACHA,AU9BA,AT2BA,AQxBA,ALeA,AGTA,ADGA,AJYA;AMjBA,ALeA,AJYA,ACHA,AU9BA,AT2BA,AU9BA,APqBA,AGTA,ADGA,AJYA;AMjBA,AT2BA,ACHA,AU9BA,AT2BA,AU9BA,APqBA,AGTA,ADGA,AJYA;AMjBA,AT2BA,ACHA,AU9BA,AT2BA,AU9BA,APqBA,AGTA,ADGA,AJYA;AMjBA,AT2BA,ACHA,AYpCA,AFMA,AT2BA,AU9BA,APqBA,AGTA,ADGA,AJYA;AMjBA,AT2BA,ACHA,AYpCA,AFMA,AT2BA,AGTA,AGTA,ADGA,AJYA;AMjBA,AT2BA,ACHA,AYpCA,AFMA,AT2BA,AGTA,AGTA,ADGA;AELA,AT2BA,ACHA,AYpCA,AFMA,AT2BA,AYpCA,AT2BA,AGTA,ADGA;AELA,AT2BA,ACHA,AU9BA,AT2BA,AYpCA,AT2BA,AGTA,ADGA;AELA,AT2BA,ACHA,AU9BA,AT2BA,AYpCA,AT2BA,AGTA,ADGA;AELA,AT2BA,ACHA,AU9BA,AT2BA,AYpCA,AT2BA,AGTA,ADGA;APsBA,ACHA,AU9BA,AT2BA,AYpCA,AT2BA,AGTA,ADGA;APsBA,ACHA,AU9BA,AT2BA,AYpCA,AT2BA,AGTA,ADGA;APsBA,ACHA,AU9BA,AT2BA,AYpCA,AT2BA,AGTA,ADGA;APsBA,ACHA,AU9BA,AT2BA,AYpCA,AT2BA,AGTA,ADGA;APsBA,ACHA,AU9BA,AT2BA,AGTA,AGTA,ADGA;APsBA,ACHA,AU9BA,AT2BA,AGTA,AGTA,ADGA;APsBA,ACHA,AU9BA,AT2BA,AGTA,AGTA,ADGA;APsBA,ACHA,AU9BA,AT2BA,AGTA,AGTA,ADGA;APsBA,AWjCA,AT2BA,AGTA,AGTA,ADGA;APsBA,AWjCA,AT2BA,AGTA,AGTA,ADGA;APsBA,AWjCA,AT2BA,AGTA,AGTA,ADGA;APsBA,AWjCA,AT2BA,AGTA,AGTA,ADGA;APsBA,AWjCA,AT2BA,AGTA,AGTA,ADGA;APsBA,AWjCA,AT2BA,AGTA,AGTA,ADGA;APsBA,AWjCA,AT2BA,AGTA,AGTA,ADGA;APsBA,AWjCA,AT2BA,AGTA,AGTA,ADGA;APsBA,AWjCA,AT2BA,AGTA,AGTA,ADGA;APsBA,AWjCA,AT2BA,AGTA,AGTA,ADGA;APsBA,AWjCA,AT2BA,AGTA,AGTA,ADGA;APsBA,AWjCA,AT2BA,AGTA,AGTA,ADGA;APsBA,AWjCA,AT2BA,AGTA,AGTA,ADGA;APsBA,AWjCA,AT2BA,AGTA,AGTA,ADGA;APsBA,AWjCA,AT2BA,AGTA,AGTA,ADGA;APsBA,AWjCA,AT2BA,AGTA,AGTA,ADGA;APsBA,AWjCA,AT2BA,AGTA,AGTA,ADGA;APsBA,AWjCA,AT2BA,AGTA,AGTA,ADGA;APsBA,AWjCA,AT2BA,AGTA,AGTA,ADGA;APsBA,AWjCA,AT2BA,AGTA,AGTA,ADGA;APsBA,AWjCA,AT2BA,AGTA,AGTA,ADGA;APsBA,AENA,AGTA,AGTA,ADGA;APsBA,AENA,AGTA,AGTA,ADGA;APsBA,AENA,AGTA,AGTA,ADGA;APsBA,AENA,AGTA,AGTA;ARyBA,AENA,AGTA,AGTA;ARyBA,AENA,AGTA,AGTA;ARyBA,AENA,AGTA,AGTA;ARyBA,AENA,AGTA,AGTA;ARyBA,AENA,AGTA,AGTA;ARyBA,AENA,AGTA,AGTA;ARyBA,AENA,AGTA,AGTA;ARyBA,AENA,AGTA,AGTA;ARyBA,AENA,AGTA,AGTA;ARyBA,AENA,AGTA,AGTA;ARyBA,AENA,AGTA,AGTA;ARyBA,AENA,AGTA,AGTA;ARyBA,AENA,AGTA,AGTA;ARyBA,AENA,AGTA,AGTA;ARyBA,AENA,AGTA,AGTA;ARyBA,AENA,AGTA,AGTA;ARyBA,AENA,AGTA,AGTA;ARyBA,AENA,AGTA,AGTA;ARyBA,AENA,AGTA,AGTA;ARyBA,AENA,AGTA,AGTA;ARyBA,AENA,AGTA,AGTA;ARyBA,AENA,AGTA,AGTA;ARyBA,AENA,AGTA,AGTA;ARyBA,AENA,AGTA,AGTA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA,AMlBA;ARyBA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA,AENA;AFOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.js","sourcesContent":["\nvar Plumbing = require('./plumbing.js')\nvar hasUnicode = require('has-unicode')\nvar hasColor = require('./has-color.js')\nvar onExit = require('signal-exit')\nvar defaultThemes = require('./themes')\nvar setInterval = require('./set-interval.js')\nvar process = require('./process.js')\nvar setImmediate = require('./set-immediate')\n\nmodule.exports = Gauge\n\nfunction callWith (obj, method) {\n  return function () {\n    return method.call(obj)\n  }\n}\n\nfunction Gauge (arg1, arg2) {\n  var options, writeTo\n  if (arg1 && arg1.write) {\n    writeTo = arg1\n    options = arg2 || {}\n  } else if (arg2 && arg2.write) {\n    writeTo = arg2\n    options = arg1 || {}\n  } else {\n    writeTo = process.stderr\n    options = arg1 || arg2 || {}\n  }\n\n  this._status = {\n    spun: 0,\n    section: '',\n    subsection: '',\n  }\n  this._paused = false // are we paused for back pressure?\n  this._disabled = true // are all progress bar updates disabled?\n  this._showing = false // do we WANT the progress bar on screen\n  this._onScreen = false // IS the progress bar on screen\n  this._needsRedraw = false // should we print something at next tick?\n  this._hideCursor = options.hideCursor == null ? true : options.hideCursor\n  this._fixedFramerate = options.fixedFramerate == null\n    ? !(/^v0\\.8\\./.test(process.version))\n    : options.fixedFramerate\n  this._lastUpdateAt = null\n  this._updateInterval = options.updateInterval == null ? 50 : options.updateInterval\n\n  this._themes = options.themes || defaultThemes\n  this._theme = options.theme\n  var theme = this._computeTheme(options.theme)\n  var template = options.template || [\n    { type: 'progressbar', length: 20 },\n    { type: 'activityIndicator', kerning: 1, length: 1 },\n    { type: 'section', kerning: 1, default: '' },\n    { type: 'subsection', kerning: 1, default: '' },\n  ]\n  this.setWriteTo(writeTo, options.tty)\n  var PlumbingClass = options.Plumbing || Plumbing\n  this._gauge = new PlumbingClass(theme, template, this.getWidth())\n\n  this._$$doRedraw = callWith(this, this._doRedraw)\n  this._$$handleSizeChange = callWith(this, this._handleSizeChange)\n\n  this._cleanupOnExit = options.cleanupOnExit == null || options.cleanupOnExit\n  this._removeOnExit = null\n\n  if (options.enabled || (options.enabled == null && this._tty && this._tty.isTTY)) {\n    this.enable()\n  } else {\n    this.disable()\n  }\n}\nGauge.prototype = {}\n\nGauge.prototype.isEnabled = function () {\n  return !this._disabled\n}\n\nGauge.prototype.setTemplate = function (template) {\n  this._gauge.setTemplate(template)\n  if (this._showing) {\n    this._requestRedraw()\n  }\n}\n\nGauge.prototype._computeTheme = function (theme) {\n  if (!theme) {\n    theme = {}\n  }\n  if (typeof theme === 'string') {\n    theme = this._themes.getTheme(theme)\n  } else if (\n    theme &&\n    (Object.keys(theme).length === 0 || theme.hasUnicode != null || theme.hasColor != null)\n  ) {\n    var useUnicode = theme.hasUnicode == null ? hasUnicode() : theme.hasUnicode\n    var useColor = theme.hasColor == null ? hasColor : theme.hasColor\n    theme = this._themes.getDefault({\n      hasUnicode: useUnicode,\n      hasColor: useColor,\n      platform: theme.platform,\n    })\n  }\n  return theme\n}\n\nGauge.prototype.setThemeset = function (themes) {\n  this._themes = themes\n  this.setTheme(this._theme)\n}\n\nGauge.prototype.setTheme = function (theme) {\n  this._gauge.setTheme(this._computeTheme(theme))\n  if (this._showing) {\n    this._requestRedraw()\n  }\n  this._theme = theme\n}\n\nGauge.prototype._requestRedraw = function () {\n  this._needsRedraw = true\n  if (!this._fixedFramerate) {\n    this._doRedraw()\n  }\n}\n\nGauge.prototype.getWidth = function () {\n  return ((this._tty && this._tty.columns) || 80) - 1\n}\n\nGauge.prototype.setWriteTo = function (writeTo, tty) {\n  var enabled = !this._disabled\n  if (enabled) {\n    this.disable()\n  }\n  this._writeTo = writeTo\n  this._tty = tty ||\n    (writeTo === process.stderr && process.stdout.isTTY && process.stdout) ||\n    (writeTo.isTTY && writeTo) ||\n    this._tty\n  if (this._gauge) {\n    this._gauge.setWidth(this.getWidth())\n  }\n  if (enabled) {\n    this.enable()\n  }\n}\n\nGauge.prototype.enable = function () {\n  if (!this._disabled) {\n    return\n  }\n  this._disabled = false\n  if (this._tty) {\n    this._enableEvents()\n  }\n  if (this._showing) {\n    this.show()\n  }\n}\n\nGauge.prototype.disable = function () {\n  if (this._disabled) {\n    return\n  }\n  if (this._showing) {\n    this._lastUpdateAt = null\n    this._showing = false\n    this._doRedraw()\n    this._showing = true\n  }\n  this._disabled = true\n  if (this._tty) {\n    this._disableEvents()\n  }\n}\n\nGauge.prototype._enableEvents = function () {\n  if (this._cleanupOnExit) {\n    this._removeOnExit = onExit(callWith(this, this.disable))\n  }\n  this._tty.on('resize', this._$$handleSizeChange)\n  if (this._fixedFramerate) {\n    this.redrawTracker = setInterval(this._$$doRedraw, this._updateInterval)\n    if (this.redrawTracker.unref) {\n      this.redrawTracker.unref()\n    }\n  }\n}\n\nGauge.prototype._disableEvents = function () {\n  this._tty.removeListener('resize', this._$$handleSizeChange)\n  if (this._fixedFramerate) {\n    clearInterval(this.redrawTracker)\n  }\n  if (this._removeOnExit) {\n    this._removeOnExit()\n  }\n}\n\nGauge.prototype.hide = function (cb) {\n  if (this._disabled) {\n    return cb && process.nextTick(cb)\n  }\n  if (!this._showing) {\n    return cb && process.nextTick(cb)\n  }\n  this._showing = false\n  this._doRedraw()\n  cb && setImmediate(cb)\n}\n\nGauge.prototype.show = function (section, completed) {\n  this._showing = true\n  if (typeof section === 'string') {\n    this._status.section = section\n  } else if (typeof section === 'object') {\n    var sectionKeys = Object.keys(section)\n    for (var ii = 0; ii < sectionKeys.length; ++ii) {\n      var key = sectionKeys[ii]\n      this._status[key] = section[key]\n    }\n  }\n  if (completed != null) {\n    this._status.completed = completed\n  }\n  if (this._disabled) {\n    return\n  }\n  this._requestRedraw()\n}\n\nGauge.prototype.pulse = function (subsection) {\n  this._status.subsection = subsection || ''\n  this._status.spun++\n  if (this._disabled) {\n    return\n  }\n  if (!this._showing) {\n    return\n  }\n  this._requestRedraw()\n}\n\nGauge.prototype._handleSizeChange = function () {\n  this._gauge.setWidth(this._tty.columns - 1)\n  this._requestRedraw()\n}\n\nGauge.prototype._doRedraw = function () {\n  if (this._disabled || this._paused) {\n    return\n  }\n  if (!this._fixedFramerate) {\n    var now = Date.now()\n    if (this._lastUpdateAt && now - this._lastUpdateAt < this._updateInterval) {\n      return\n    }\n    this._lastUpdateAt = now\n  }\n  if (!this._showing && this._onScreen) {\n    this._onScreen = false\n    var result = this._gauge.hide()\n    if (this._hideCursor) {\n      result += this._gauge.showCursor()\n    }\n    return this._writeTo.write(result)\n  }\n  if (!this._showing && !this._onScreen) {\n    return\n  }\n  if (this._showing && !this._onScreen) {\n    this._onScreen = true\n    this._needsRedraw = true\n    if (this._hideCursor) {\n      this._writeTo.write(this._gauge.hideCursor())\n    }\n  }\n  if (!this._needsRedraw) {\n    return\n  }\n  if (!this._writeTo.write(this._gauge.show(this._status))) {\n    this._paused = true\n    this._writeTo.on('drain', callWith(this, function () {\n      this._paused = false\n      this._doRedraw()\n    }))\n  }\n}\n","\nvar consoleControl = require('console-control-strings')\nvar renderTemplate = require('./render-template.js')\nvar validate = require('aproba')\n\nvar Plumbing = module.exports = function (theme, template, width) {\n  if (!width) {\n    width = 80\n  }\n  validate('OAN', [theme, template, width])\n  this.showing = false\n  this.theme = theme\n  this.width = width\n  this.template = template\n}\nPlumbing.prototype = {}\n\nPlumbing.prototype.setTheme = function (theme) {\n  validate('O', [theme])\n  this.theme = theme\n}\n\nPlumbing.prototype.setTemplate = function (template) {\n  validate('A', [template])\n  this.template = template\n}\n\nPlumbing.prototype.setWidth = function (width) {\n  validate('N', [width])\n  this.width = width\n}\n\nPlumbing.prototype.hide = function () {\n  return consoleControl.gotoSOL() + consoleControl.eraseLine()\n}\n\nPlumbing.prototype.hideCursor = consoleControl.hideCursor\n\nPlumbing.prototype.showCursor = consoleControl.showCursor\n\nPlumbing.prototype.show = function (status) {\n  var values = Object.create(this.theme)\n  for (var key in status) {\n    values[key] = status[key]\n  }\n\n  return renderTemplate(this.width, this.template, values).trim() +\n         consoleControl.color('reset') +\n         consoleControl.eraseLine() + consoleControl.gotoSOL()\n}\n","\nvar align = require('wide-align')\nvar validate = require('aproba')\nvar wideTruncate = require('./wide-truncate')\nvar error = require('./error')\nvar TemplateItem = require('./template-item')\n\nfunction renderValueWithValues (values) {\n  return function (item) {\n    return renderValue(item, values)\n  }\n}\n\nvar renderTemplate = module.exports = function (width, template, values) {\n  var items = prepareItems(width, template, values)\n  var rendered = items.map(renderValueWithValues(values)).join('')\n  return align.left(wideTruncate(rendered, width), width)\n}\n\nfunction preType (item) {\n  var cappedTypeName = item.type[0].toUpperCase() + item.type.slice(1)\n  return 'pre' + cappedTypeName\n}\n\nfunction postType (item) {\n  var cappedTypeName = item.type[0].toUpperCase() + item.type.slice(1)\n  return 'post' + cappedTypeName\n}\n\nfunction hasPreOrPost (item, values) {\n  if (!item.type) {\n    return\n  }\n  return values[preType(item)] || values[postType(item)]\n}\n\nfunction generatePreAndPost (baseItem, parentValues) {\n  var item = Object.assign({}, baseItem)\n  var values = Object.create(parentValues)\n  var template = []\n  var pre = preType(item)\n  var post = postType(item)\n  if (values[pre]) {\n    template.push({ value: values[pre] })\n    values[pre] = null\n  }\n  item.minLength = null\n  item.length = null\n  item.maxLength = null\n  template.push(item)\n  values[item.type] = values[item.type]\n  if (values[post]) {\n    template.push({ value: values[post] })\n    values[post] = null\n  }\n  return function ($1, $2, length) {\n    return renderTemplate(length, template, values)\n  }\n}\n\nfunction prepareItems (width, template, values) {\n  function cloneAndObjectify (item, index, arr) {\n    var cloned = new TemplateItem(item, width)\n    var type = cloned.type\n    if (cloned.value == null) {\n      if (!(type in values)) {\n        if (cloned.default == null) {\n          throw new error.MissingTemplateValue(cloned, values)\n        } else {\n          cloned.value = cloned.default\n        }\n      } else {\n        cloned.value = values[type]\n      }\n    }\n    if (cloned.value == null || cloned.value === '') {\n      return null\n    }\n    cloned.index = index\n    cloned.first = index === 0\n    cloned.last = index === arr.length - 1\n    if (hasPreOrPost(cloned, values)) {\n      cloned.value = generatePreAndPost(cloned, values)\n    }\n    return cloned\n  }\n\n  var output = template.map(cloneAndObjectify).filter(function (item) {\n    return item != null\n  })\n\n  var remainingSpace = width\n  var variableCount = output.length\n\n  function consumeSpace (length) {\n    if (length > remainingSpace) {\n      length = remainingSpace\n    }\n    remainingSpace -= length\n  }\n\n  function finishSizing (item, length) {\n    if (item.finished) {\n      throw new error.Internal('Tried to finish template item that was already finished')\n    }\n    if (length === Infinity) {\n      throw new error.Internal('Length of template item cannot be infinity')\n    }\n    if (length != null) {\n      item.length = length\n    }\n    item.minLength = null\n    item.maxLength = null\n    --variableCount\n    item.finished = true\n    if (item.length == null) {\n      item.length = item.getBaseLength()\n    }\n    if (item.length == null) {\n      throw new error.Internal('Finished template items must have a length')\n    }\n    consumeSpace(item.getLength())\n  }\n\n  output.forEach(function (item) {\n    if (!item.kerning) {\n      return\n    }\n    var prevPadRight = item.first ? 0 : output[item.index - 1].padRight\n    if (!item.first && prevPadRight < item.kerning) {\n      item.padLeft = item.kerning - prevPadRight\n    }\n    if (!item.last) {\n      item.padRight = item.kerning\n    }\n  })\n\n  // Finish any that have a fixed (literal or intuited) length\n  output.forEach(function (item) {\n    if (item.getBaseLength() == null) {\n      return\n    }\n    finishSizing(item)\n  })\n\n  var resized = 0\n  var resizing\n  var hunkSize\n  do {\n    resizing = false\n    hunkSize = Math.round(remainingSpace / variableCount)\n    output.forEach(function (item) {\n      if (item.finished) {\n        return\n      }\n      if (!item.maxLength) {\n        return\n      }\n      if (item.getMaxLength() < hunkSize) {\n        finishSizing(item, item.maxLength)\n        resizing = true\n      }\n    })\n  } while (resizing && resized++ < output.length)\n  if (resizing) {\n    throw new error.Internal('Resize loop iterated too many times while determining maxLength')\n  }\n\n  resized = 0\n  do {\n    resizing = false\n    hunkSize = Math.round(remainingSpace / variableCount)\n    output.forEach(function (item) {\n      if (item.finished) {\n        return\n      }\n      if (!item.minLength) {\n        return\n      }\n      if (item.getMinLength() >= hunkSize) {\n        finishSizing(item, item.minLength)\n        resizing = true\n      }\n    })\n  } while (resizing && resized++ < output.length)\n  if (resizing) {\n    throw new error.Internal('Resize loop iterated too many times while determining minLength')\n  }\n\n  hunkSize = Math.round(remainingSpace / variableCount)\n  output.forEach(function (item) {\n    if (item.finished) {\n      return\n    }\n    finishSizing(item, hunkSize)\n  })\n\n  return output\n}\n\nfunction renderFunction (item, values, length) {\n  validate('OON', arguments)\n  if (item.type) {\n    return item.value(values, values[item.type + 'Theme'] || {}, length)\n  } else {\n    return item.value(values, {}, length)\n  }\n}\n\nfunction renderValue (item, values) {\n  var length = item.getBaseLength()\n  var value = typeof item.value === 'function' ? renderFunction(item, values, length) : item.value\n  if (value == null || value === '') {\n    return ''\n  }\n  var alignWith = align[item.align] || align.left\n  var leftPadding = item.padLeft ? align.left('', item.padLeft) : ''\n  var rightPadding = item.padRight ? align.right('', item.padRight) : ''\n  var truncated = wideTruncate(String(value), length)\n  var aligned = alignWith(truncated, length)\n  return leftPadding + aligned + rightPadding\n}\n","\nvar stringWidth = require('string-width')\nvar stripAnsi = require('strip-ansi')\n\nmodule.exports = wideTruncate\n\nfunction wideTruncate (str, target) {\n  if (stringWidth(str) === 0) {\n    return str\n  }\n  if (target <= 0) {\n    return ''\n  }\n  if (stringWidth(str) <= target) {\n    return str\n  }\n\n  // We compute the number of bytes of ansi sequences here and add\n  // that to our initial truncation to ensure that we don't slice one\n  // that we want to keep in half.\n  var noAnsi = stripAnsi(str)\n  var ansiSize = str.length + noAnsi.length\n  var truncated = str.slice(0, target + ansiSize)\n\n  // we have to shrink the result to account for our ansi sequence buffer\n  // (if an ansi sequence was truncated) and double width characters.\n  while (stringWidth(truncated) > target) {\n    truncated = truncated.slice(0, -1)\n  }\n  return truncated\n}\n","\nvar util = require('util')\n\nvar User = exports.User = function User (msg) {\n  var err = new Error(msg)\n  Error.captureStackTrace(err, User)\n  err.code = 'EGAUGE'\n  return err\n}\n\nexports.MissingTemplateValue = function MissingTemplateValue (item, values) {\n  var err = new User(util.format('Missing template value \"%s\"', item.type))\n  Error.captureStackTrace(err, MissingTemplateValue)\n  err.template = item\n  err.values = values\n  return err\n}\n\nexports.Internal = function Internal (msg) {\n  var err = new Error(msg)\n  Error.captureStackTrace(err, Internal)\n  err.code = 'EGAUGEINTERNAL'\n  return err\n}\n","\nvar stringWidth = require('string-width')\n\nmodule.exports = TemplateItem\n\nfunction isPercent (num) {\n  if (typeof num !== 'string') {\n    return false\n  }\n  return num.slice(-1) === '%'\n}\n\nfunction percent (num) {\n  return Number(num.slice(0, -1)) / 100\n}\n\nfunction TemplateItem (values, outputLength) {\n  this.overallOutputLength = outputLength\n  this.finished = false\n  this.type = null\n  this.value = null\n  this.length = null\n  this.maxLength = null\n  this.minLength = null\n  this.kerning = null\n  this.align = 'left'\n  this.padLeft = 0\n  this.padRight = 0\n  this.index = null\n  this.first = null\n  this.last = null\n  if (typeof values === 'string') {\n    this.value = values\n  } else {\n    for (var prop in values) {\n      this[prop] = values[prop]\n    }\n  }\n  // Realize percents\n  if (isPercent(this.length)) {\n    this.length = Math.round(this.overallOutputLength * percent(this.length))\n  }\n  if (isPercent(this.minLength)) {\n    this.minLength = Math.round(this.overallOutputLength * percent(this.minLength))\n  }\n  if (isPercent(this.maxLength)) {\n    this.maxLength = Math.round(this.overallOutputLength * percent(this.maxLength))\n  }\n  return this\n}\n\nTemplateItem.prototype = {}\n\nTemplateItem.prototype.getBaseLength = function () {\n  var length = this.length\n  if (\n    length == null &&\n    typeof this.value === 'string' &&\n    this.maxLength == null &&\n    this.minLength == null\n  ) {\n    length = stringWidth(this.value)\n  }\n  return length\n}\n\nTemplateItem.prototype.getLength = function () {\n  var length = this.getBaseLength()\n  if (length == null) {\n    return null\n  }\n  return length + this.padLeft + this.padRight\n}\n\nTemplateItem.prototype.getMaxLength = function () {\n  if (this.maxLength == null) {\n    return null\n  }\n  return this.maxLength + this.padLeft + this.padRight\n}\n\nTemplateItem.prototype.getMinLength = function () {\n  if (this.minLength == null) {\n    return null\n  }\n  return this.minLength + this.padLeft + this.padRight\n}\n","\nvar colorSupport = require('color-support')\n\nmodule.exports = colorSupport().hasBasic\n","\nvar color = require('console-control-strings').color\nvar ThemeSet = require('./theme-set.js')\n\nvar themes = module.exports = new ThemeSet()\n\nthemes.addTheme('ASCII', {\n  preProgressbar: '[',\n  postProgressbar: ']',\n  progressbarTheme: {\n    complete: '#',\n    remaining: '.',\n  },\n  activityIndicatorTheme: '-\\\\|/',\n  preSubsection: '>',\n})\n\nthemes.addTheme('colorASCII', themes.getTheme('ASCII'), {\n  progressbarTheme: {\n    preComplete: color('bgBrightWhite', 'brightWhite'),\n    complete: '#',\n    postComplete: color('reset'),\n    preRemaining: color('bgBrightBlack', 'brightBlack'),\n    remaining: '.',\n    postRemaining: color('reset'),\n  },\n})\n\nthemes.addTheme('brailleSpinner', {\n  preProgressbar: '(',\n  postProgressbar: ')',\n  progressbarTheme: {\n    complete: '#',\n    remaining: '⠂',\n  },\n  activityIndicatorTheme: '⠋⠙⠹⠸⠼⠴⠦⠧⠇⠏',\n  preSubsection: '>',\n})\n\nthemes.addTheme('colorBrailleSpinner', themes.getTheme('brailleSpinner'), {\n  progressbarTheme: {\n    preComplete: color('bgBrightWhite', 'brightWhite'),\n    complete: '#',\n    postComplete: color('reset'),\n    preRemaining: color('bgBrightBlack', 'brightBlack'),\n    remaining: '⠂',\n    postRemaining: color('reset'),\n  },\n})\n\nthemes.setDefault({}, 'ASCII')\nthemes.setDefault({ hasColor: true }, 'colorASCII')\nthemes.setDefault({ platform: 'darwin', hasUnicode: true }, 'brailleSpinner')\nthemes.setDefault({ platform: 'darwin', hasUnicode: true, hasColor: true }, 'colorBrailleSpinner')\nthemes.setDefault({ platform: 'linux', hasUnicode: true }, 'brailleSpinner')\nthemes.setDefault({ platform: 'linux', hasUnicode: true, hasColor: true }, 'colorBrailleSpinner')\n","\n\nmodule.exports = function () {\n  return ThemeSetProto.newThemeSet()\n}\n\nvar ThemeSetProto = {}\n\nThemeSetProto.baseTheme = require('./base-theme.js')\n\nThemeSetProto.newTheme = function (parent, theme) {\n  if (!theme) {\n    theme = parent\n    parent = this.baseTheme\n  }\n  return Object.assign({}, parent, theme)\n}\n\nThemeSetProto.getThemeNames = function () {\n  return Object.keys(this.themes)\n}\n\nThemeSetProto.addTheme = function (name, parent, theme) {\n  this.themes[name] = this.newTheme(parent, theme)\n}\n\nThemeSetProto.addToAllThemes = function (theme) {\n  var themes = this.themes\n  Object.keys(themes).forEach(function (name) {\n    Object.assign(themes[name], theme)\n  })\n  Object.assign(this.baseTheme, theme)\n}\n\nThemeSetProto.getTheme = function (name) {\n  if (!this.themes[name]) {\n    throw this.newMissingThemeError(name)\n  }\n  return this.themes[name]\n}\n\nThemeSetProto.setDefault = function (opts, name) {\n  if (name == null) {\n    name = opts\n    opts = {}\n  }\n  var platform = opts.platform == null ? 'fallback' : opts.platform\n  var hasUnicode = !!opts.hasUnicode\n  var hasColor = !!opts.hasColor\n  if (!this.defaults[platform]) {\n    this.defaults[platform] = { true: {}, false: {} }\n  }\n  this.defaults[platform][hasUnicode][hasColor] = name\n}\n\nThemeSetProto.getDefault = function (opts) {\n  if (!opts) {\n    opts = {}\n  }\n  var platformName = opts.platform || process.platform\n  var platform = this.defaults[platformName] || this.defaults.fallback\n  var hasUnicode = !!opts.hasUnicode\n  var hasColor = !!opts.hasColor\n  if (!platform) {\n    throw this.newMissingDefaultThemeError(platformName, hasUnicode, hasColor)\n  }\n  if (!platform[hasUnicode][hasColor]) {\n    if (hasUnicode && hasColor && platform[!hasUnicode][hasColor]) {\n      hasUnicode = false\n    } else if (hasUnicode && hasColor && platform[hasUnicode][!hasColor]) {\n      hasColor = false\n    } else if (hasUnicode && hasColor && platform[!hasUnicode][!hasColor]) {\n      hasUnicode = false\n      hasColor = false\n    } else if (hasUnicode && !hasColor && platform[!hasUnicode][hasColor]) {\n      hasUnicode = false\n    } else if (!hasUnicode && hasColor && platform[hasUnicode][!hasColor]) {\n      hasColor = false\n    } else if (platform === this.defaults.fallback) {\n      throw this.newMissingDefaultThemeError(platformName, hasUnicode, hasColor)\n    }\n  }\n  if (platform[hasUnicode][hasColor]) {\n    return this.getTheme(platform[hasUnicode][hasColor])\n  } else {\n    return this.getDefault(Object.assign({}, opts, { platform: 'fallback' }))\n  }\n}\n\nThemeSetProto.newMissingThemeError = function newMissingThemeError (name) {\n  var err = new Error('Could not find a gauge theme named \"' + name + '\"')\n  Error.captureStackTrace.call(err, newMissingThemeError)\n  err.theme = name\n  err.code = 'EMISSINGTHEME'\n  return err\n}\n\nThemeSetProto.newMissingDefaultThemeError =\n  function newMissingDefaultThemeError (platformName, hasUnicode, hasColor) {\n    var err = new Error(\n      'Could not find a gauge theme for your platform/unicode/color use combo:\\n' +\n    '    platform = ' + platformName + '\\n' +\n    '    hasUnicode = ' + hasUnicode + '\\n' +\n    '    hasColor = ' + hasColor)\n    Error.captureStackTrace.call(err, newMissingDefaultThemeError)\n    err.platform = platformName\n    err.hasUnicode = hasUnicode\n    err.hasColor = hasColor\n    err.code = 'EMISSINGTHEME'\n    return err\n  }\n\nThemeSetProto.newThemeSet = function () {\n  var themeset = function (opts) {\n    return themeset.getDefault(opts)\n  }\n  return Object.assign(themeset, ThemeSetProto, {\n    themes: Object.assign({}, this.themes),\n    baseTheme: Object.assign({}, this.baseTheme),\n    defaults: JSON.parse(JSON.stringify(this.defaults || {})),\n  })\n}\n","\nvar spin = require('./spin.js')\nvar progressBar = require('./progress-bar.js')\n\nmodule.exports = {\n  activityIndicator: function (values, theme, width) {\n    if (values.spun == null) {\n      return\n    }\n    return spin(theme, values.spun)\n  },\n  progressbar: function (values, theme, width) {\n    if (values.completed == null) {\n      return\n    }\n    return progressBar(theme, width, values.completed)\n  },\n}\n","\n\nmodule.exports = function spin (spinstr, spun) {\n  return spinstr[spun % spinstr.length]\n}\n","\nvar validate = require('aproba')\nvar renderTemplate = require('./render-template.js')\nvar wideTruncate = require('./wide-truncate')\nvar stringWidth = require('string-width')\n\nmodule.exports = function (theme, width, completed) {\n  validate('ONN', [theme, width, completed])\n  if (completed < 0) {\n    completed = 0\n  }\n  if (completed > 1) {\n    completed = 1\n  }\n  if (width <= 0) {\n    return ''\n  }\n  var sofar = Math.round(width * completed)\n  var rest = width - sofar\n  var template = [\n    { type: 'complete', value: repeat(theme.complete, sofar), length: sofar },\n    { type: 'remaining', value: repeat(theme.remaining, rest), length: rest },\n  ]\n  return renderTemplate(width, template, theme)\n}\n\n// lodash's way of repeating\nfunction repeat (string, width) {\n  var result = ''\n  var n = width\n  do {\n    if (n % 2) {\n      result += string\n    }\n    n = Math.floor(n / 2)\n    /* eslint no-self-assign: 0 */\n    string += string\n  } while (n && stringWidth(result) < width)\n\n  return wideTruncate(result, width)\n}\n","\n// this exists so we can replace it during testing\nmodule.exports = setInterval\n","\n// this exists so we can replace it during testing\nmodule.exports = process\n","\nvar process = require('./process')\ntry {\n  module.exports = setImmediate\n} catch (ex) {\n  module.exports = process.nextTick\n}\n"]}